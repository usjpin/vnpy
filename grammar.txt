S0 -> D* EOF

D -> Conf | SetD | FunD | Stmt
Conf -> "config" ConfType Value ";"
ConfType -> "width" | "height" | "mode"
Value -> num | "console" | "graphic"
SetD -> "let" id ( "=" D )? ";"
FunD -> "fun" Func

Func -> id "(" Params? ")" Block
Parmas -> id ( "," id )*
Args -> Expr ( "," Expr)*

Stmt -> ExprS | IfS | ReturnS | WhileS | Block | SpecS 
ExprS -> Expr ";"
IfS -> "if" "(" Exp ")" Stmt ( "else" Stmt )?
WhileS -> "while" "(" Expr ")" Stmt
Block -> "{" D* "}"

SpecS -> Sc | Dis | Audio | Opt | Wait | Jump
Sc -> "scene" id "{" S* "}"
Dis -> "display" (Expr | Message | Opt) ";"
Audio -> "audio" ("start" | "stop") Expr ";"
Message -> "message" Expr
Opt -> "options" "{" Case* "}"
Case -> "case" ( id | string ) "do" Expr ";"
Wait -> "wait" ( Input | num) ";"
Jump -> "jump" Expr ";"
Input -> "choice" | "click" Click | "key" Key
Key -> KEY_UP | KEY_DOWN | KEY_LEFT | KEY_RIGHT
Click -> CLICK_LEFT | CLICK_RIGHT | CLICK_BOTH

Expr -> A
A -> id "=" A | Or
Or -> And ("or" And)*
And -> Eq ("and" Eq)*
Eq -> Comp ( ("!=" | "==" ) Comp )*
Comp -> Term ( ( ">" | ">=" | "<" | "<=" ) Term )*
Term -> Fact ( ( "-" | "+" ) Fac )*
Fact -> U ( ( "/" | "*" ) U )*
U -> ( "!" | "-" ) U | C
C -> Prim ( "(" Args ")" )*
Prim -> "true" | "false" | "nil" | num | string | id | "(" Expr ")"

===========================================

scene a {
    display message "hihi";
    display options {
        case "ok" do {
            wait 5;
        }
        case "meh" do {
            set a = 5;
        }
    }
    scene suba {

    }
    set ok = wait input (choice | click | key)
}

===========================================

set first = nil;
set second = nil;

fun delayAndExit() {
    delay 500;
    exit;
}

fun displayError() {
    display "An error occured"
}

scene Sub {
    if (first && second) {
        set result = first - second;
        display "The subtraction result is " + result;
    } else displayError();
    delayAndExit();
}

scene Add {
    if (first && second) {
        set result = first + second;
        display "The addition result is " + result;
    } else displayError();
    delayAndExit();
}

scene main {
    display "Pick a number" [
        option "1" do set first = 1;
        option "2" do set first = 2;
        option "3" do set first = 3;
    ]
    display "Pick another number" [
        set i = 0
        while (i <= 10) {
            option i do set second = i;
	    i = i + 1;
        }
    ]
    display "Pick an operation" [
         option "add" do jump Add;
         option "sub" do jump Sub;
    ]
}

jump main